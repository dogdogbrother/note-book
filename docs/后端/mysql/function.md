## 表达式

`1+1`是一个表达式,在mysql中,`1`是 `操作数`,`+`是`操作符`.

### 操作数
mysql操作数除了`数字/字符串/时间`值这些常数,还可以是列名/表达式之类的.

### 操作符
1. 算术运算符.

除了常规的`+-*/`加减乘除,`%`取余,`-`负数.还有`DIV`除法取整.

例如`2 DIV 3`结果是0.

2. 比较操作符

其实就是布尔表达式,只返回`true`或`false`除了常规的`=`,`!=`,`<`,`<=`这些,还有:

|操作符|示例|描述|
|-|---|---|
|BETWEEN|a BETWEEN b AND c|满足 b <= a <= c|
|NOT BETWEEN|a NOT BETWEEN b AND c|不满足 b <= a <= c|
|IN|a IN (b1, b2, ...)|a是b1, b2, ... 中的某一个|
|NOT IN|a NOT IN (b1, b2, ...)|a不是b1, b2, ... 中的任意一个|
|IS NULL|a IS NULL|a的值是NULL|
|IS NOT NULL|a IS NOT NULL|a的值不是NULL|
|LIKE|a LIKE b|a匹配b|
|NOT LIKE|a NOT LIKE b|a不匹配b|

3. 逻辑操作符

就是将多个布尔表达式连接起来:
|操作符|示例|描述|
|-|---|---|
|AND|a AND b|只有a和b同时为真，表达式才为真|
|OR|a OR b|只要a或b有任意一个为真，表达式就为真|
|XOR|a XOR b|a和b有且只有一个为真，表达式为真|

## 表达式的使用

主要使用在查询列表中,修改数据库内容的返回格式.

把`score`的数据都加100:
```
mysql> SELECT  number, subject, score + 100 AS score FROM student_score;
+----------+-----------------------------+-------+
| number   | subject                     | score |
+----------+-----------------------------+-------+
| 20180101 | 母猪的产后护理              |   178 |
| 20180101 | 论萨达姆的战争准备          |   188 |
| 20180102 | 母猪的产后护理              |   200 |
| 20180102 | 论萨达姆的战争准备          |   198 |
| 20180103 | 母猪的产后护理              |   159 |
| 20180103 | 论萨达姆的战争准备          |   161 |
| 20180104 | 母猪的产后护理              |   155 |
| 20180104 | 论萨达姆的战争准备          |   146 |
+----------+-----------------------------+-------+
8 rows in set (0.00 sec)
```

## 函数

其实就是把查到数据用MySQL提供的函数做层封装返回.

### 文本处理函数
|名称|调用示例|示例结果|描述|
|-|---|---|---|
|LEFT|LEFT('abc123', 3)|abc|给定字符串从左边取指定长度的子串|
|RIGHT|RIGHT('abc123', 3)|123|给定字符串从右边取指定长度的子串|
|LENGTH|LENGTH('abc')|3|给定字符串的长度|
|LOWER|LOWER('ABC')|abc|给定字符串的小写格式|
|UPPER|	UPPER('abc')|ABC|给定字符串的大写格式|
|LTRIM|LTRIM(' abc')|abc|给定字符串左边空格去除后的格式|
|RTRIM|RTRIM('abc ')|abc|给定字符串右边空格去除后的格式|
|SUBSTRING|SUBSTRING('abc123', 2, 3)|bc1|给定字符串从指定位置截取指定长度的子串|
|CONCAT|CONCAT('abc', '123', 'xyz')|abc123xyz|将给定的各个字符串拼接成一个新字符串|

用`CONCAT`拼接字符串写个案例:
```
mysql> SELECT CONCAT('学号为', number, '的学生在《', subject, '》课程的成绩是：', score) AS 成绩描述 FROM student_score;
+---------------------------------------------------------------------------------------+
| 成绩描述                                                                              |
+---------------------------------------------------------------------------------------+
| 学号为20180101的学生在《母猪的产后护理》课程的成绩是：78                              |
| 学号为20180101的学生在《论萨达姆的战争准备》课程的成绩是：88                          |
| 学号为20180102的学生在《母猪的产后护理》课程的成绩是：100                             |
| 学号为20180102的学生在《论萨达姆的战争准备》课程的成绩是：98                          |
| 学号为20180103的学生在《母猪的产后护理》课程的成绩是：59                              |
| 学号为20180103的学生在《论萨达姆的战争准备》课程的成绩是：61                          |
| 学号为20180104的学生在《母猪的产后护理》课程的成绩是：55                              |
| 学号为20180104的学生在《论萨达姆的战争准备》课程的成绩是：46                          |
+---------------------------------------------------------------------------------------+
8 rows in set (0.00 sec)
```

### 日期时间处理函数
|名称|调用示例|示例结果|描述|
|-|---|---|---|
|NOW|NOW()|abc|返回当前日期和时间|
|CURDATE|CURDATE()|2019-08-16|返回当前日期|
|CURTIME|CURTIME()|17:10:43|返回当前时间|
|DATE|DATE('2019-08-16 17:10:43')|2019-08-16|将给定日期和时间值的日期提取出来|
|DATE_ADD|DATE_ADD('2019-08-16 17:10:43', INTERVAL 2 DAY)|2019-08-18 17:10:43|将给定的日期和时间值添加指定的时间间隔|
|DATE_SUB|DATE_SUB('2019-08-16 17:10:43', INTERVAL 2 DAY)|2019-08-14 17:10:43|将给定的日期和时间值减去指定的时间间隔|
|DATEDIFF|	DATEDIFF('2019-08-16', '2019-08-17');|-1|返回两个日期之间的天数（负数代表前一个参数代表的日期比较小）|
|DATE_FORMAT|DATE_FORMAT(NOW(),'%m-%d-%Y')|08-16-2019|用给定的格式显示日期和时间|

### 时间单位
在使用`DATE_ADD`和`DATE_SUB`增减时间时,时间间隔可以指定:

|时间单位|描述|
|---|---|
|MICROSECOND|毫秒|
|SECOND|秒|
|MINUTE|分钟|
|HOUR|小时|
|DAY|天|
|WEEK|星期|
|MONTH|月|
|QUARTER|季度|
|YEAR|年|

### 格式化时间符
使用`DATE_FORMAT`时需要了解的.
|格式符|描述|
|---|---|
|%b|简写的月份名称（Jan、Feb、...、Dec)|
|%D|带有英文后缀的月份中的日期（0th、1st、2nd、...、31st)|
|%d|数字格式的月份中的日期(00、01、02、...、31)|
|%f|微秒（000000-999999）|
|%H|二十四小时制的小时 (00-23)|
|%h|十二小时制的小时 (01-12)|
|%i|数值格式的分钟(00-59)|
|%M|月份名（January、February、...、December）|
|%m|数值形式的月份(00-12)|
|%p|上午或下午（AM代表上午、PM代表下午|
|%S|秒(00-59)|
|%s|秒(00-59)|
|%W|星期名（Sunday、Monday、...、Saturday）|
|%w|周内第几天 （0=星期日、1=星期一、 6=星期六|
|%Y|4位数字形式的年（例如2019）|
|%y|2位数字形式的年（例如19）|

```
mysql> SELECT DATE_FORMAT(NOW(),'%b %d %Y %h:%i %p');
+----------------------------------------+
| DATE_FORMAT(NOW(),'%b %d %Y %h:%i %p') |
+----------------------------------------+
| Aug 16 2019 05:10 PM                   |
+----------------------------------------+
1 row in set (0.00 sec)
```

### 数值处理函数
数学上常用到的函数,对number类型的数据进行处理.
|名称|调用示例|实例结果|描述|
|--|---|---|---|
|ABS|ABS(-1)|1|取绝对值|
|MOD|MOD(5,2)|1|返回除法的余数|
|RAND|RAND()|0.7537623539136372|返回一个随机数|

## 聚集函数

其实就是统计用的,对列的全部数据检索处理.

|函数名|描述|
|---|---|
|COUNT|返回某列的行数|
|MAX|返回某列的最大值|
|MIN|返回某列的最小值|
|SUM|返回某列值之和|
|AVG|返回某列的平均值|
|DISTINCT|过滤重复数据|

### COUNT函数

`COUNT`函数使用来统计行数的，它有下边两种使用方式：

1. COUNT(*)：对表中行的数目进行计数，不管列的值是不是NULL。
2. COUNT(列名)：对特定的列进行计数，会忽略掉该列为NULL的行.
```
mysql> SELECT COUNT(*) FROM student_info;
+----------+
| COUNT(*) |
+----------+
|        6 |
+----------+
1 row in set (0.00 sec)
```

### DISTINCT函数

假如想知道`student_info`表中存储了多少个专业:
```
SELECT COUNT(DISTINCT major) FROM student_info;
```

## 隐式转换

1. 在计算时,`'1'+'1'`会得到`2`.
2. 函数期望的类型会转换,例如连接字符串的`CONCAT`函数,即使传入的是数组,还是会变成字符串.
```
CONCAT(1, 2)  →  '12'
```
3. 存数据时,会把值转换为列需要的值.例如`TINYINT`的列存了`'100'`,会变成数字.`VARCHAR`存数字会变成字符串.
